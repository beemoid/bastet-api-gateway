services:
  api-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    image: api-gateway:latest
    container_name: api-gateway
    restart: unless-stopped

    # All config comes from .env — copy .env.example → .env and fill in values
    env_file: .env

    ports:
      - "${SERVER_PORT:-8080}:${SERVER_PORT:-8080}"

    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider",
             "http://localhost:${SERVER_PORT:-8080}/health"]
      interval: 30s
      timeout: 5s
      start_period: 10s
      retries: 3

    # Use host networking so the container can reach on-premise SQL Server.
    # Comment out and use the bridge network below if databases are also containerised.
    network_mode: host

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "5"

# ── Bridge network (alternative to host mode) ─────────────────────────────────
# Uncomment below and remove "network_mode: host" above when databases
# are also running in Docker on the same host.
#
# networks:
#   api-net:
#     driver: bridge
